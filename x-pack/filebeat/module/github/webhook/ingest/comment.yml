description: Pipeline to parse commit_comment, issue_comment and pull_request_review_comment github wehhooks
processors:
- rename:
    field: github.comment.commit_id
    target_field: github.related.commit.id
    ignore_missing: true
- rename:
    field: github.issue.id
    target_field: github.related.issue.id
    ignore_missing: true
- rename:
    field: github.comment.id
    target_field: github.related.comment.id
    ignore_missing: true
- rename:
    field: github.comment.html_url
    target_field: github.related.comment.url
    ignore_missing: true
- append:
    field: event.type
    value: creation
- set:
    field: event.kind
    value: event
- set:
    field: event.action
    value: commit_comment-{{github.action}}
    if: ctx.github?.issue == null && ctx.github?.pull_request == null && ctx.github?.comment != null
- set:
    field: event.action
    value: issue_comment-{{github.action}}
    if: ctx.github?.issue != null && ctx.github?.pull_request == null
- set:
    field: event.action
    value: review_comment-{{github.action}}
    if: ctx.github?.issue != null && ctx.github?.pull_request != null
- remove:
    field:
    - github.comment
    - github.repository
    - github.issue
    - github.organization
    - github.installation
    - github.sender
    ignore_missing: true
on_failure:
- set:
    field: error.message
    value: '{{ _ingest.on_failure_message }}'
