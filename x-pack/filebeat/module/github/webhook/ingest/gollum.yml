description: Pipeline to parse gollum github wehhooks
processors:
- append:
    field: event.type
    value:
    - info
    - creation
    - change
- set:
    field: event.outcome
    value: success
- set:
    field: event.kind
    value: event
- set:
    field: event.action
    value: gollum-event
- foreach:
    field: github.pages
    processor:
      append:
        field: github.related.page.name
        value: '{{_ingest._value.page_name}}'
- foreach:
    field: github.pages
    processor:
      append:
        field: github.related.page.sha
        value: '{{_ingest._value.sha}}'
- foreach:
    field: github.pages
    processor:
      append:
        field: github.related.page.url
        value: '{{_ingest._value.html_url}}'
- script:
    lang: painless
    source: ctx.github.related.page.count = (ctx.github.pages).length()
    if: ctx.github?.pages != null
- remove:
    field:
    - github.pages
    - github.repository
    - github.organization
    - github.installation
    - github.sender
on_failure:
- set:
    field: error.message
    value: '{{ _ingest.on_failure_message }}'
