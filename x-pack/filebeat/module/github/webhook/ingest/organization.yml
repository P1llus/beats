description: Pipeline to parse organization github wehhooks
processors:
- append:
    field: event.type
    value: iam
- append:
    field: event.type
    value: creation
    if: ctx.github?.action == 'added'
- append:
    field: event.type
    value: change
    if: "['renamed', 'member_added', 'member_removed', 'member_invited'].contains(ctx.github?.action)"
- append:
    field: event.type
    value: deletion
    if: ctx.github?.action == 'deleted'
- append:
    field: related.user
    value: "{{github.membership.user.login}}"
    if: ctx.github?.membership?.user?.login != null
- set:
    field: event.action
    value: organization-{{github.action}}
- rename:
    field: github.membership.url
    target_field: github.related.membership.url
    ignore_missing: true
- rename:
    field: github.membership.state
    target_field: github.related.membership.state
    ignore_missing: true
- rename:
    field: github.membership.role
    target_field: github.related.membership.role
    ignore_missing: true
- rename:
    field: github.membership.role
    target_field: github.related.membership.role
    ignore_missing: true
- rename:
    field: github.membership.user.login
    target_field: github.related.user.name
    ignore_missing: true
- rename:
    field: github.membership.user.id
    target_field: github.related.user.id
    ignore_missing: true
- rename:
    field: github.membership.user.site_admin
    target_field: github.related.user.site_admin
    ignore_missing: true
- remove:
    field:
    - github.check_run
    - github.check_suite
    - github.repository
    - github.organization
    - github.installation
    - github.sender
    - github.membership
    ignore_missing: true
on_failure:
- set:
    field: error.message
    value: '{{ _ingest.on_failure_message }}'
