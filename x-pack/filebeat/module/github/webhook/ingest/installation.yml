description: Pipeline to parse installation github wehhooks
processors:
- set:
    field: observer.name
    value: '{{github.repository.name}}'
- set:
    field: observer.product
    value: Webhook
- set:
    field: observer.vendor
    value: Github
- append:
    field: related.user
    value: '{{github.sender.login}}'
    if: ctx.github?.sender?.type == 'User'
- append:
    field: event.type
    value:
    - info
    - installation
- append:
    field: event.type
    value: creation
    if: ctx.github?.action == 'created'
- append:
    field: event.type
    value: deletion
    if: ctx.github?.action == 'deleted'
- set:
    field: event.outcome
    value: success
- set:
    field: event.kind
    value: event
- set:
    field: event.action
    value: installation-{{github.action}}
- rename:
    field: github.sender.login
    target_field: source.user.name
    ignore_missing: true
- rename:
    field: github.sender.id
    target_field: source.user.id
    ignore_missing: true
- foreach:
    field: github.repositories
    processor:
      append:
        field: github.related.repositories
        value: '{{_ingest._value.full_name}}'
- script:
    lang: painless
    source: ctx.github.repositories_count = (ctx.github.repositories).length
    if: ctx.github?.repositories != null
on_failure:
- set:
    field: error.message
    value: '{{ _ingest.on_failure_message }}'
