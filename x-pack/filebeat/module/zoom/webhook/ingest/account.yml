description: Pipeline for parsing Zoom account webhooks
processors:
- append:
    field: event.category
    value: iam
- append:
    field: event.type
    value: user
- append:
    field: event.type
    value: creation
    if: ctx?.event?.action == 'account.created'
- append:
    field: event.type
    value: change
    if: "['account.updated', 'account.settings_updated', 'account.disassociated'].contains(ctx?.event?.action)"
- rename:
    field: zoom.account_id
    target_field: zoom.master_account_id
    ignore_missing: true
- rename:
    field: zoom.object.id
    target_field: zoom.sub_account_id
    ignore_missing: true
- rename:
    field: zoom.object
    target_field: zoom.account
    if: ctx?.event?.action != 'account.created'
- rename:
    field: zoom.old_object
    target_field: zoom.old_account
    if: ctx?.event?.action != 'account.created'
- append:
    field: related.user
    value: "{{zoom.account.owner_id}}"
    if: "ctx?.zoom?.account?.owner_id != null"
on_failure:
- set:
    field: error.message
    value: '{{ _ingest.on_failure_message }}'
