module_version: 1.0

var:
  - name: input
    default: httpjson
  - name: url
    default: https://api.amp.cisco.com/v1/events?offset=0&limit=300
  - name: tags
    default: [cisco-amp, forwarded]
  - name: ssl
  - name: client_id
  - name: api_key
  - name: interval
    default: 1m
  - name: start_date
    default:
      target: url.params.start_date
      value: '{{ formatDate (now (parseDuration "-1m")) "2006-01-02T15:04:05-0700" }}'
  - name: link_pagination
    default:
      target: url.value
      value: '{{ last_response.body.metadata.links.next }}'
  - name: rate_limit
    default:
      value: '{{ last_response.header.Get "x-ratelimit-limit"}}'
  - name: rate_reset
    default:
      value: '{{ last_response.header.Get "x-ratelimit-reset"}}'
  - name: rate_remaining
    default:
      value: '{{ last_response.header.Get "x-ratelimit-remaining"}}'

ingest_pipeline:
  - ingest/pipeline.yml
input: config/config.yml
